<!doctype html>
<html lang="en">
<script src="/assets/js/ux-accessibility.js" defer></script>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Complaint Portal • COVID Accountability</title>
  <link rel="stylesheet" href="/assets/site.css"/>
  <link rel="icon" href="/assets/img/favicon.ico"/>
</head>
<body>
  <div id="nav-root"></div>
  <script src="/assets/nav-include.js" defer></script>

  <main id="main" class="container" role="main" aria-label="Complaint Portal">
    <h1 class="page-title">Complaint Portal</h1>
    <p class="page-subtitle">
      Select your state and the appropriate board. We’ll open the official site in a new tab.
      Your report content is prepared locally and not stored by us.
    </p>

    <div class="cp-grid">

      <fieldset class="cp-section">
        <legend>Choose your state</legend>
        <label for="stateSelect">State</label>
        <select id="stateSelect" name="state" style="min-width:220px">
          <option value="">Select a state…</option>
        </select>
        <p class="cp-row"><span>We maintain links to official complaint portals. After choosing a state, pick a board.</span></p>
      </fieldset>

      <fieldset class="cp-section">
        <legend>Select a board in your state</legend>
        <div id="boardsContainer" class="cp-boards" role="radiogroup" aria-label="Boards"></div>
      </fieldset>

      <section class="cp-section">
        <h3>Open board site</h3>
        <div class="cp-row">
          <span class="cp-badge" id="statusBadge">✅ Success!</span>
        </div>
        <p>
          <button id="open-board" class="btn btn-primary" type="button">Open selected board page</button>
        </p>
      </section>

    </div>

    <p class="page-legal"><a href="/privacy.html">Privacy</a> · <a href="/disclaimer.html">Disclaimer</a></p>
  </main>

  <script>
    // Minimal client logic to populate states/boards and open the selected board.
    // If you already have /assets/js/portal.js with data/hooks, this is compatible:
    // it uses #stateSelect, #boardsContainer, and #open-board.

    const STATE_DATA = (window.STATE_DATA || {
      "Louisiana":[
        {"name":"Louisiana State Board of Medical Examiners","url":"https://www.lsbme.la.gov"}
      ]
      // Add more states as needed or leave to your existing JS to overwrite.
    });

    const stateSelect = document.getElementById('stateSelect');
    const boardsContainer = document.getElementById('boardsContainer');
    const openBtn = document.getElementById('open-board');
    let selectedUrl = "";

    function renderStates(){
      const keys = Object.keys(STATE_DATA).sort();
      for (const k of keys){
        const opt = document.createElement('option');
        opt.value = k; opt.textContent = k;
        stateSelect.appendChild(opt);
      }
    }

    function renderBoards(st){
      boardsContainer.innerHTML = '';
      selectedUrl = '';
      const boards = STATE_DATA[st] || [];
      boards.forEach((b, idx) => {
        const id = `board-${idx}`;
        const label = document.createElement('label');
        label.innerHTML = `<input type="radio" name="board" id="${id}" value="${b.url}"> <span>${b.name} ${b.url}</span>`;
        boardsContainer.appendChild(label);
      });
      boardsContainer.addEventListener('change', (e)=>{
        if (e.target && e.target.name === 'board') selectedUrl = e.target.value;
      }, {once:true});
    }

    stateSelect.addEventListener('change', e => renderBoards(e.target.value));
    openBtn.addEventListener('click', () => {
      if (!selectedUrl){ alert('Please select a board.'); return; }
      window.open(selectedUrl, '_blank', 'noopener');
    });

    renderStates();
  </script>
</body>
</html>
