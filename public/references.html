<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>References — COVIDAccountabilityNow</title>
  <link rel="stylesheet" href="/assets/site.css"/>
</head>
<body>
  <div id="nav-root"></div>
  <script src="/assets/nav-include.js" defer></script>

  <main class="container">
    <h1>References</h1>
    <p class="small">Curated materials that support reporting and accountability.</p>
    <!-- S12: last-checked badge (non-intrusive, inherits existing styles) -->
    <p class="small" id="refsMeta">
      Last checked: <span id="refsChecked">—</span>
    </p>

    <section id="refsStatus" role="status" aria-live="polite" class="card small">Loading…</section>
    <section id="refsList" class="grid grid-2"></section>
  </main>

  <footer>
    <a href="/privacy.html">Privacy</a> · <a href="/disclaimer.html">Disclaimer</a>
  </footer>

  <!-- Self-contained renderer (no external references*.js) -->
  <script type="module">
    const statusEl = document.getElementById('refsStatus');
    const listEl = document.getElementById('refsList');

    const esc = (s='') => s.toString()
      .replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');

    async function loadReferences() {
      const res = await fetch('/assets/references.json?v=' + Date.now(), { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      return res.json();
    }

    function render(items = []) {
      listEl.innerHTML = '';
      for (const r of items) {
        const card = document.createElement('article');
        card.setAttribute('role', 'listitem');
        card.className = 'card';
        card.innerHTML = `
          <h3 class="h4">
            <a href="${esc(r.url)}" target="_blank" rel="noopener">${esc(r.title || r.url)}</a>
          </h3>
          <p class="small">
            ${esc(r.source || '')}${r.date ? ' · ' + esc(r.date) : ''}
          </p>
          ${r.description ? `<p>${esc(r.description)}</p>` : ''}
        `;
        listEl.appendChild(card);
      }
    }

    (async () => {
      try {
        const data = await loadReferences();
        render(Array.isArray(data) ? data : []);
        statusEl.remove(); // remove status/blip when done
      } catch (e) {
        statusEl.textContent = 'Could not load references.';
        console.error('references load error:', e);
      }
    })();
  </script>
</body>
</html>
